{% extends "layout.html" %}

{% block head %}
<style>
    .answer-container {
        max-height: 600px;
        overflow-y: auto;
    }
    
    .chat-message {
        margin-bottom: 15px;
        padding: 15px;
        border-radius: 8px;
    }
    
    .user-message {
        background-color: var(--bs-dark);
        border-left: 4px solid var(--bs-primary);
    }
    
    .assistant-message {
        background-color: var(--bs-dark);
        border-left: 4px solid var(--bs-info);
    }
    
    .citation-tag {
        display: inline-block;
        font-size: 0.8em;
        background-color: var(--bs-dark);
        color: var(--bs-info);
        padding: 0.2em 0.5em;
        border-radius: 4px;
        cursor: pointer;
        margin: 0 2px;
        border: 1px solid var(--bs-info);
    }
    
    .citation-details {
        font-size: 0.9em;
        padding: 10px;
        margin-top: 5px;
        border-radius: 4px;
        background-color: var(--bs-dark);
        border-left: 4px solid var(--bs-secondary);
    }
    
    .conversation-heading {
        border-bottom: 1px solid var(--bs-gray-700);
        padding-bottom: 10px;
        margin-bottom: 20px;
    }
    
    #uploadForm {
        transition: all 0.3s ease;
    }
    
    .drag-over {
        background-color: var(--bs-dark) !important;
    }
    
    .new-conversation-btn {
        position: absolute;
        right: 15px;
        top: 15px;
        z-index: 100;
    }
    
    @media (max-width: 768px) {
        .new-conversation-btn {
            position: static;
            margin-bottom: 15px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="row">
    <!-- First card - Query Input -->
    <div class="col-lg-6 mb-4">
        <div class="card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-message-circle me-2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>
                    Ask a Question
                </h5>
                <button id="newConversationBtn" class="btn btn-sm btn-outline-secondary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                    New Conversation
                </button>
            </div>
            <div class="card-body">
                <form id="queryForm">
                    <div class="mb-3">
                        <label for="queryInput" class="form-label">Enter your query about the scientific documents:</label>
                        <textarea class="form-control" id="queryInput" rows="4" placeholder="e.g., What are the main findings on climate change in the uploaded papers?" required></textarea>
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-send me-2"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                            Submit Query
                        </button>
                    </div>
                </form>
                
                <div class="mt-4">
                    <h6 class="mb-3">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-upload me-2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                        Upload Documents
                    </h6>
                    <form id="uploadForm" class="p-3 border rounded">
                        <div class="mb-3">
                            <label for="fileInput" class="form-label">Choose PDF files (max 50 files at once):</label>
                            <input class="form-control" type="file" id="fileInput" name="files[]" multiple accept=".pdf">
                        </div>
                        <div class="progress mb-3 d-none" id="uploadProgress">
                            <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-outline-primary" id="uploadButton">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-upload-cloud me-2"><polyline points="16 16 12 12 8 16"></polyline><line x1="12" y1="12" x2="12" y2="21"></line><path d="M20.39 18.39A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.3"></path><polyline points="16 16 12 12 8 16"></polyline></svg>
                                Upload PDFs
                            </button>
                        </div>
                    </form>
                    <div id="uploadStatus" class="mt-3"></div>
                    <div id="processingQueue" class="mt-3 d-none">
                        <div class="d-flex justify-content-between">
                            <h6>Processing Status:</h6>
                            <small class="text-muted" id="queueInfo"></small>
                        </div>
                        <div class="progress">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" id="queueProgress"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Second card - Answer Display -->
    <div class="col-lg-6 mb-4">
        <div class="card h-100">
            <div class="card-header">
                <h5 class="mb-0">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-award me-2"><circle cx="12" cy="8" r="7"></circle><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline></svg>
                    Research Assistant
                </h5>
            </div>
            <div class="card-body answer-container" id="conversationContainer">
                <div class="conversation-heading">
                    <h5 id="conversationTitle">New Conversation</h5>
                    <p class="text-muted">Ask a question about the research documents you've uploaded.</p>
                </div>
                <div id="conversationHistory">
                    <!-- Conversation messages will be displayed here -->
                    <div class="text-center text-muted py-5">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-message-square mb-3"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                        <p>Your conversation will appear here</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/main.js') }}"></script>
<script src="{{ url_for('static', filename='js/query_interface.js') }}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        initFileUpload();
        initQueryInterface();
    });
</script>
{% endblock %}